name: TOTO Number Generator

on:
  schedule:
    # Daily standard generation at 12 PM SGT (4 AM UTC)
    - cron: '0 4 * * *'
    # Check for Telegram messages every 15 minutes during active hours (8 AM - 11 PM SGT → 0:00–15:00 UTC)
    - cron: '*/15 0-15 * * *'

  # Manual trigger from GitHub
  workflow_dispatch:
    inputs:
      sets:
        description: 'Number of TOTO sets'
        required: true
        default: '1'
        type: string

jobs:
  generate-toto:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    - name: Install dependencies
      run: pip install requests

    - name: Run TOTO system
      env:
        TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
      run: |
        if [ "${{ github.event_name }}" = "workflow_dispatch" ]; then
          echo "Manual trigger: generating ${{ inputs.sets }} sets"
          python toto-generator.py "${{ inputs.sets }}"
        elif [ "${{ github.event.schedule }}" = "0 4 * * *" ]; then
          echo "Daily 12 PM SGT: generating standard 1 set"
          python toto-generator.py 1
        else
          echo "15-minute check: looking for Telegram messages only"
          python telegram_listener_check_only.py
        fi